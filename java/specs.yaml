metadata:
  sso:
    fields:
      - name: authenticated
        type: boolean
      - name: sessionId
        type: String
  roles:
    fields:
      - name: roleName
        type: String
      - name: roleLevel
        type: int
  user:
    fields:
      - name: userId
        type: String
      - name: clearanceLevel
        type: int
  location:
    fields:
      - name: locationId
        type: String
      - name: locationName
        type: String
      - name: longitude
        type: float
      - name: latitude
        type: float


rules:
  - name: CountryOfOriginCheck
    target:
      type: model
      name: Employee
      domain: appget
    conditions:
      - field: country_of_origin
        operator: "=="
        value: "USA"
    then:
      status: "APPROVED"
    else:
      status: "REJECTED"

  - name: EmployeeAgeCheck
    target:
      type: model
      name: Employee
      domain: appget
    blocking: true
    conditions:
      - field: age
        operator: ">"
        value: 18
    then:
      status: "APPROVED"
    else:
      status: "REJECTED"

  - name: EmployeeRoleCheck
    target:
      type: model
      name: Employee
      domain: appget
    conditions:
      - field: role_id
        operator: "=="
        value: "Manager"
    then:
      status: "APPROVED"
    else:
      status: "REJECTED"

  - name: SeniorManagerCheck
    target:
      type: model
      name: Employee
      domain: appget
    conditions:
      operator: AND
      clauses:
        - field: age
          operator: ">="
          value: 30
        - field: role_id
          operator: "=="
          value: "Manager"
    then:
      status: "SENIOR_MANAGER"
    else:
      status: "NOT_SENIOR_MANAGER"

  - name: HighEarnerCheck
    target:
      type: view
      name: EmployeeSalaryView
      domain: appget
    conditions:
      - field: salary_amount
        operator: ">"
        value: 100000
    then:
      status: "HIGH_EARNER"
    else:
      status: "STANDARD_EARNER"

  - name: AuthenticatedApproval
    target:
      type: model
      name: Employee
      domain: appget
    blocking: true
    requires:
      sso:
        - field: authenticated
          operator: "=="
          value: true
      roles:
        - field: roleLevel
          operator: ">="
          value: 3
    conditions:
      - field: age
        operator: ">="
        value: 25
    then:
      status: "APPROVED_WITH_AUTH"
    else:
      status: "DENIED"

  - name: SalaryAmountCheck
    target:
      type: model
      name: Salary
      domain: hr
    conditions:
      - field: amount
        operator: ">"
        value: 50000
    then:
      status: "PREMIUM"
    else:
      status: "STANDARD"
